"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,n,i,u,l=[],o=!0,s=!1;try{if(i=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;o=!1}else for(;!(o=(r=i.call(a)).done)&&(l.push(r.value),l.length!==t);o=!0);}catch(e){s=!0,n=e}finally{try{if(!o&&null!=a.return&&(u=a.return(),Object(u)!==u))return}finally{if(s)throw n}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,l=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return u=e.done,e},e:function(e){l=!0,i=e},f:function(){try{u||null==a.return||a.return()}finally{if(l)throw i}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}for(var ICAOS=["HKHB","HRYR","TAPT","UEEA","UEEE","UELL","UERP","UERR","UESO","UESS","UEST","UHBB","UHBI","UHBW","UHHH","UHKK","UHMA","UHMD","UHMM","UHMP","UHNN","UHOO","UHPP","UHSS","UHWW","UIAA","UIBB","UIBS","UIII","UITT","UIUU","ULAA","ULAM","ULAS","ULBC","ULDD","ULKK","ULLI","ULMK","ULMM","ULNN","ULOL","ULOO","ULPB","ULSS","ULWU","ULWW","UMKK","UNAA","UNBB","UNEE","UNII","UNKL","UNKS","UNKY","UNNT","UNOO","UNSS","UNTT","UNWW","UODD","UOHH","UOII","URKA","URKG","URKK","URMG","URML","URMM","URMN","URMO","URMT","URRR","URRY","URSS","URWA","URWI","URWW","USCC","USCM","USDD","USHU","USII","USKK","USMM","USMU","USNN","USNR","USPP","USRK","USRN","USRO","USRR","USSS","USTO","USTJ","USTR","USUU","UUBA","UUBB","UUBC","UUBI","UUBK","UUBP","UUBS","UUBT","UUDD","UUDL","UUEE","UUEM","UUOB","UUOK","UUOL","UUOO","UUOR","UUOT","UUWR","UUWW","UUYH","UUYI","UUYP","UUYS","UUYW","UUYY","UWGG","UWKB","UWKD","UWKE","UWKJ","UWKS","UWLW","UWOO","UWOR","UWPP","UWPS","UWSB","UWSS","UWUB","UWUF","UWUK","UWUU","UWWW"],VISIBILITY_VALUES=[],i=0;i<800;i+=50)VISIBILITY_VALUES.push(i);for(var _i=800;_i<5e3;_i+=100)VISIBILITY_VALUES.push(_i);for(var _i2=5e3;_i2<1e4;_i2+=1e3)VISIBILITY_VALUES.push(_i2);VISIBILITY_VALUES.push(9999);var AMTK_CreationForm=function(){return _createClass((function e(t){var a,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,e),this.root=document.querySelector(t),this.forms={input:document.forms[null!==(a=n.input)&&void 0!==a?a:"amtk_input"],output:document.forms[null!==(r=n.output)&&void 0!==r?r:"amtk_output"]},this.groups=new Map,this.elements=this.forms.input.elements}),[{key:"addGroup",value:function(e){var t=this.forms,a=t.input.elements;this.groups.set(e,{forms:t,elements:a,handlers:new Map})}},{key:"addHandler",value:function(e){var t,a=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.groups.has(e)||this.addGroup(e);var n=null!==(t=r.name)&&void 0!==t?t:e,i=this.groups.get(e),u=this.elements[n],l=r.init,o=r.auxiliary,s=r.format,d=r.update;try{var p;l&&(l.call(this,u.value),this.updateOutput()),u.addEventListener(null!==(p=r.event)&&void 0!==p?p:"input",(function(e){if(s&&(u.value=s.call(a,u.value,e),i.value=u.value),o&&o.call(a,u.value,e),d){var t=d.call(a,u.value,e);i.value=t}a.updateOutput()}))}catch(t){console.error(n,e,u)}}},{key:"updateOutput",value:function(){var e,t=this.forms.output.elements.report,a=[],r=_createForOfIteratorHelper(this.groups);try{for(r.s();!(e=r.n()).done;){var n=_slicedToArray(e.value,2),i=(n[0],n[1]);null!=i.value&&a.push(i.value)}}catch(e){r.e(e)}finally{r.f()}t.value=a.join(" ").replace(/\s{2,}/," ")}}])}();function isEmpty(e){return null==e||""==e}function isNotEmpty(e){return!isEmpty(e)}function toUpperCase(e){return e.toUpperCase()}var amtk_form=new AMTK_CreationForm("#metar_form");function initType(){for(var e=this.elements,t=e.metar,a=e.speci,r=this.groups.get("type"),n=0,i=[t,a];n<i.length;n++){var u=i[n];if(u.checked)return void(r.value=u.value.toUpperCase())}r.value=""}function updateICAO(){var e=this.elements.icao.value;return 4===e.length?e.toUpperCase():""}function updateDateTime(){var e=this.elements,t=e.date,a=e.time,r=t.value.split("-").at(-1)+(a.value.replace(/:/,"")+"Z");return 7===r.length?r:""}function updateWind(){var e=this.elements.units,t=this.elements,a=t.direction,r=t.speed,n=t.gust;if(isNotEmpty(a.value)&&isNotEmpty(r.value)&&0!=r.value){var i=e.value.toUpperCase(),u=a.value.padStart(3,"0"),l=r.value.padStart(2,"0");return u+l+(isNotEmpty(n.value)&&0!=+n.value&&+n.value>+l?"G"+n.value.padStart(2,"0"):"")+i}return""}function updateVisibility(){var e=this.elements.visibility.value;return isNotEmpty(e)&&0!=e?e:""}function updateWeather(){var e=this.elements.weather.value;return e.length>1?e:""}function auxiliaryWeatherIntensity(e,t){var a,r=this.elements,n=r.weather,i=_createForOfIteratorHelper(r.intensity);try{for(i.s();!(a=i.n()).done;){var u=a.value;u===t.target?n.value=(t.target.checked?u.value:"")+n.value.replace(/[^A-Z]/,""):u.checked=!1}}catch(e){i.e(e)}finally{i.f()}}function auxiliaryWeatherVariants(e,t){var a=this.elements.weather;[this.elements.weather_variants,this.elements.weather_phenomenas].includes(t.target)||(a.value+=e.toUpperCase())}function updateClouds(){var e=this.elements.clouds.value;if(e.length>5)return e}function auxiliaryClouds(e){var t,a=e.clouds,r=e.height,n=e.clouds_variants,i=e.clouds_type,u="",l=_createForOfIteratorHelper(n.options);try{for(l.s();!(t=l.n()).done;){var o=t.value;if(o.selected){u=o.value.toUpperCase();break}}}catch(e){l.e(e)}finally{l.f()}var s,d=r.value.padStart(3,"0"),p="",m=_createForOfIteratorHelper(i);try{for(m.s();!(s=m.n()).done;){var c=s.value;if(c.checked){p=c.value.toUpperCase();break}}}catch(e){m.e(e)}finally{m.f()}a.value=u+d+p}function auxiliaryCloudsType(e,t){var a,r=_createForOfIteratorHelper(this.elements.clouds_type);try{for(r.s();!(a=r.n()).done;){var n=a.value;n===t.target||(n.checked=!1)}}catch(e){r.e(e)}finally{r.f()}auxiliaryClouds(this.elements)}function formatTemperature(e){return(e=+e.match(/-?\d?\d?/))<-80?-80:e>60?60:e}function auxiliaryTemperature(e,t){var a=this.elements,r=a.temperature,n=a.temperature_range,i=this.elements,u=i.dew_point,l=i.dew_point_range,o=null;switch(t.target){case r:o=n;break;case u:o=l;break;default:return}o.value=e}function auxiliaryTemperatureRange(e,t){var a=this.elements,r=a.temperature,n=a.temperature_range,i=this.elements,u=i.dew_point,l=i.dew_point_range,o=null;switch(t.target){case n:o=r;break;case l:o=u;break;default:return}o.value=e}function updateTemperature(e,t){var a=this.elements,r=a.temperature,n=a.dew_point,i=+r.value<0,u=+n.value<0,l=(i?"M":"")+Math.abs(+r.value).toString().padStart(2,"0"),o=(u?"M":"")+Math.abs(+n.value).toString().padStart(2,"0");return l.length||o.length?"".concat(l,"/").concat(o):""}function updatePressure(e,t){return"Q"+e.padStart(4,"0")}amtk_form.addHandler("type",{name:"metar",init:initType,update:toUpperCase}),amtk_form.addHandler("type",{name:"speci",init:initType,update:toUpperCase}),amtk_form.addHandler("icao",{auxiliary:function(){var e=this.elements.type;this.groups.get("type").value=e.value.toUpperCase()},format:function(e){var t=this.elements.icao_variants,a=e.toUpperCase().replace(/[^A-Z]/,"").slice(0,4),r=a?ICAOS.filter((function(e){return e.startsWith(a)})).slice(0,10):[];if(t.innerHTML="",r.length){var n,i=_createForOfIteratorHelper(r);try{for(i.s();!(n=i.n()).done;){var u=n.value,l=document.createElement("option");l.value=u,l.textContent=u,t.append(l)}}catch(e){i.e(e)}finally{i.f()}t.disabled=!1}else{var o=document.createElement("option");o.textContent="Не найдено",t.append(o),t.disabled=!0}return a},update:updateICAO}),amtk_form.addHandler("icao",{name:"icao_variants",event:"click",auxiliary:function(e,t){var a=this.elements.icao,r=this.elements.icao_variants;console.log(t.target,t.currentTarget),t.target!==r&&(a.value=e.toUpperCase())},update:updateICAO}),amtk_form.addHandler("datetime",{name:"date",update:updateDateTime}),amtk_form.addHandler("datetime",{name:"time",update:updateDateTime}),amtk_form.addHandler("datetime",{name:"current",event:"click",auxiliary:function(e,t){var a,r=this.elements,n=r.date,i=r.time,u=(new Date).toISOString().split("T");n.value=u.at(0),i.value=null===(a=u.at(1))||void 0===a?void 0:a.slice(0,5)},update:updateDateTime}),amtk_form.addHandler("wind",{name:"mps",update:updateWind}),amtk_form.addHandler("wind",{name:"kt",update:updateWind}),amtk_form.addHandler("wind",{name:"direction",format:function(e){var t=e.replace(/[^0-9]/,"").slice(0,3);return t<=350?t:350},auxiliary:function(e){this.elements.direction_range.value=isNotEmpty(e)||0!=e?10*Math.round(+e/10):0},update:updateWind}),amtk_form.addHandler("wind",{name:"direction_range",auxiliary:function(e){this.elements.direction.value=e},update:updateWind}),amtk_form.addHandler("wind",{name:"speed",format:function(e){return e.replace(/[^0-9]/,"").slice(0,2)},auxiliary:function(e){this.elements.speed_range.value=isNotEmpty(e)?+e:0},update:updateWind}),amtk_form.addHandler("wind",{name:"speed_range",auxiliary:function(e){this.elements.speed.value=e},update:updateWind}),amtk_form.addHandler("wind",{name:"gust",format:function(e){return e.replace(/[^0-9]/,"").slice(0,2)},auxiliary:function(e){this.elements.gust_range.value=isNotEmpty(e)?+e:0},update:updateWind}),amtk_form.addHandler("wind",{name:"gust_range",auxiliary:function(e){this.elements.gust.value=e},update:updateWind}),amtk_form.addHandler("visibility",{format:function(e){return e.replace(/\D/g,"").slice(0,4)},auxiliary:function(e){var t=this.elements.visibility_range,a=+e,r=a<800?50:a<5e3?100:a<9999?1e3:0,n=VISIBILITY_VALUES.at(-1);if(r>0){var i=Math.floor(a/r)*r;n=VISIBILITY_VALUES.indexOf(i)}t.value=n.toString()},update:updateVisibility}),amtk_form.addHandler("visibility",{name:"visibility_range",init:function(e){this.elements.visibility_range.setAttribute("max",VISIBILITY_VALUES.length-1)},auxiliary:function(e){this.elements.visibility.value=VISIBILITY_VALUES.at(+e)},update:updateVisibility}),amtk_form.addHandler("weather",{format:function(e){var t,a=this.elements.intensity,r=e.toUpperCase().replace(/(?<=^)[^-+A-Z]|(?<!^)[^A-Z]/,""),n=r.at(0),i=_createForOfIteratorHelper(a);try{for(i.s();!(t=i.n()).done;){var u=t.value;u.checked=u.value===n}}catch(e){i.e(e)}finally{i.f()}return r},update:updateWeather}),amtk_form.addHandler("weather",{name:"weather_minus",event:"click",auxiliary:auxiliaryWeatherIntensity,update:updateWeather}),amtk_form.addHandler("weather",{name:"weather_plus",event:"click",auxiliary:auxiliaryWeatherIntensity,update:updateWeather}),amtk_form.addHandler("weather",{name:"weather_variants",event:"click",auxiliary:auxiliaryWeatherVariants,update:updateWeather}),amtk_form.addHandler("weather",{name:"weather_phenomenas",event:"click",auxiliary:auxiliaryWeatherVariants,update:updateWeather}),amtk_form.addHandler("clouds",{name:"clouds",format:function(e){return e.toUpperCase().replace(/[^A-Z\d]/,"")},auxiliary:function(e){var t="",a=this.elements.height,r=""===(t=e.replace(/\D/g,"").slice(0,3))?0:parseInt(t);a.value=r>100?100:r;var n=this.elements.clouds_variants;t=e.slice(0,3).toLowerCase();var i,u=_createForOfIteratorHelper(n.options);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(l.value===t){n.value=l.value;break}}}catch(e){u.e(e)}finally{u.f()}var o=this.elements.clouds_type;t=e.replace(/\s/g,"").slice(6).toLowerCase(),console.log(t);var s,d=_createForOfIteratorHelper(o);try{for(d.s();!(s=d.n()).done;){var p=s.value;p.checked=p.value===t}}catch(e){d.e(e)}finally{d.f()}},update:updateClouds}),amtk_form.addHandler("clouds",{name:"height",auxiliary:function(e){auxiliaryClouds(this.elements)},update:updateClouds}),amtk_form.addHandler("clouds",{name:"clouds_variants",event:"click",auxiliary:function(e,t){var a=this.elements,r=(a.clouds,a.height,this.elements.clouds_variants);t.target!==r&&auxiliaryClouds(this.elements)},update:updateClouds}),amtk_form.addHandler("clouds",{name:"cb",event:"click",auxiliary:auxiliaryCloudsType,update:updateClouds}),amtk_form.addHandler("clouds",{name:"tcu",event:"click",auxiliary:auxiliaryCloudsType,update:updateClouds}),amtk_form.addHandler("temperature",{format:formatTemperature,auxiliary:auxiliaryTemperature,update:updateTemperature}),amtk_form.addHandler("temperature",{name:"temperature_range",auxiliary:auxiliaryTemperatureRange,update:updateTemperature}),amtk_form.addHandler("temperature",{name:"dew_point",format:formatTemperature,auxiliary:auxiliaryTemperature,update:updateTemperature}),amtk_form.addHandler("temperature",{name:"dew_point_range",auxiliary:auxiliaryTemperatureRange,update:updateTemperature}),amtk_form.addHandler("pressure",{format:function(e){return e.replace(/\D/g,"").slice(0,4)},auxiliary:function(e){e=+e,this.elements.pressure_range.value=e<500?500:e>1100?1100:e},update:updatePressure}),amtk_form.addHandler("pressure",{name:"pressure_range",auxiliary:function(e){this.elements.pressure.value=e},update:updatePressure});