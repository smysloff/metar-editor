const e=["HKHB","HRYR","TAPT","UEEA","UEEE","UELL","UERP","UERR","UESO","UESS","UEST","UHBB","UHBI","UHBW","UHHH","UHKK","UHMA","UHMD","UHMM","UHMP","UHNN","UHOO","UHPP","UHSS","UHWW","UIAA","UIBB","UIBS","UIII","UITT","UIUU","ULAA","ULAM","ULAS","ULBC","ULDD","ULKK","ULLI","ULMK","ULMM","ULNN","ULOL","ULOO","ULPB","ULSS","ULWU","ULWW","UMKK","UNAA","UNBB","UNEE","UNII","UNKL","UNKS","UNKY","UNNT","UNOO","UNSS","UNTT","UNWW","UODD","UOHH","UOII","URKA","URKG","URKK","URMG","URML","URMM","URMN","URMO","URMT","URRR","URRY","URSS","URWA","URWI","URWW","USCC","USCM","USDD","USHU","USII","USKK","USMM","USMU","USNN","USNR","USPP","USRK","USRN","USRO","USRR","USSS","USTO","USTJ","USTR","USUU","UUBA","UUBB","UUBC","UUBI","UUBK","UUBP","UUBS","UUBT","UUDD","UUDL","UUEE","UUEM","UUOB","UUOK","UUOL","UUOO","UUOR","UUOT","UUWR","UUWW","UUYH","UUYI","UUYP","UUYS","UUYW","UUYY","UWGG","UWKB","UWKD","UWKE","UWKJ","UWKS","UWLW","UWOO","UWOR","UWPP","UWPS","UWSB","UWSS","UWUB","UWUF","UWUK","UWUU","UWWW"],t=[];for(let x=0;x<800;x+=50)t.push(x);for(let x=800;x<5e3;x+=100)t.push(x);for(let x=5e3;x<1e4;x+=1e3)t.push(x);t.push(9999);const a=new class{constructor(e,t={}){this.root=document.querySelector(e),this.forms={input:document.forms[t.input??"amtk_input"],output:document.forms[t.output??"amtk_output"]},this.groups=new Map,this.elements=this.forms.input.elements}addGroup(e){const{forms:t}=this,{elements:a}=t.input;this.groups.set(e,{forms:t,elements:a,handlers:new Map})}addHandler(e,t={}){this.groups.has(e)||this.addGroup(e);const a=t.name??e,n=this.groups.get(e),s=this.elements[a],{init:r,auxiliary:i,format:l,update:u}=t;try{r&&(r.call(this,s.value),this.updateOutput()),s.addEventListener(t.event??"input",(e=>{if(l&&(s.value=l.call(this,s.value,e),n.value=s.value),i&&i.call(this,s.value,e),u){const t=u.call(this,s.value,e);n.value=t}this.updateOutput()}))}catch(d){console.error(a,e,s)}}updateOutput(){const{report:e}=this.forms.output.elements,t=[];for(const[a,n]of this.groups)null!=n.value&&t.push(n.value);e.value=t.join(" ").replace(/\s{2,}/," ")}}("#metar_form");function n(e){return 0===+e}function s(e){return e.toUpperCase()}function r(e,t){return function(){for(const a of t??[]){const t=document.createElement("option");t.value=a,t.textContent=a,e.append(t)}}}function i(){const{metar:e,speci:t}=this.elements,a=this.groups.get("type");for(const n of[e,t])if(n.checked)return void(a.value=n.value.toUpperCase());a.value=""}function l(){const{value:e}=this.elements.icao;return 4===e.length?e.toUpperCase():""}function u(){const{date:e,time:t}=this.elements,a=e.value.split("-").at(-1)+(t.value.replace(/:/,"")+"Z");return 7===a.length?a:""}function d(){const{units:e}=this.elements,{direction:t,speed:a,gust:s}=this.elements;if(!n(t.value)&&!n(a.value)){const r=e.value.toUpperCase(),i=t.value.padStart(3,"0"),l=a.value.padStart(2,"0");return i+l+(!n(s.value)&&+s.value>+l?"G"+s.value.padStart(2,"0"):"")+r}return""}function o(){const{value:e}=this.elements.visibility;return n(e)?"":e}a.addHandler("type",{name:"metar",init:i,update:s}),a.addHandler("type",{name:"speci",init:i,update:s}),a.addHandler("icao",{auxiliary(){const{type:e}=this.elements;this.groups.get("type").value=e.value.toUpperCase()},format(t){const a=this.elements.icao_variants,n=t.toUpperCase().replace(/[^A-Z]/,"").slice(0,4),s=n?e.filter((e=>e.startsWith(n))).slice(0,10):[];if(a.innerHTML="",s.length){for(const e of s){const t=document.createElement("option");t.value=e,t.textContent=e,a.append(t)}a.disabled=!1}else{const e=document.createElement("option");e.textContent="Не найдено",a.append(e),a.disabled=!0}return n},update:l}),a.addHandler("icao",{name:"icao_variants",event:"change",auxiliary(e,t){const{icao:a}=this.elements;a.value=e.toUpperCase()},update:l}),a.addHandler("datetime",{name:"date",update:u}),a.addHandler("datetime",{name:"time",update:u}),a.addHandler("datetime",{name:"current",event:"click",auxiliary(e,t){var a;const{date:n,time:s}=this.elements,r=(new Date).toISOString().split("T");n.value=r.at(0),s.value=null==(a=r.at(1))?void 0:a.slice(0,5)},update:u}),a.addHandler("wind",{name:"mps",update:d}),a.addHandler("wind",{name:"kt",update:d}),a.addHandler("wind",{name:"direction",format(e){const t=e.replace(/[^0-9]/,"").slice(0,3);return t<=350?t:350},auxiliary(e){const{direction_range:t}=this.elements,{speed:a,speed_range:s}=this.elements,{gust:r,gust_range:i}=this.elements;t.value=n(e)?0:10*Math.round(+e/10),0===+e&&(a.value=0,s.value=0,r.value=0,i.value=0)},update:d}),a.addHandler("wind",{name:"direction_range",auxiliary(e){const{direction:t}=this.elements,{speed:a,speed_range:n}=this.elements,{gust:s,gust_range:r}=this.elements;t.value=e,0===+e&&(a.value=0,n.value=0,s.value=0,r.value=0)},update:d}),a.addHandler("wind",{name:"speed",format:e=>e.replace(/[^0-9]/,"").slice(0,2),auxiliary(e){const{speed_range:t}=this.elements;t.value=n(e)?0:+e},update:d}),a.addHandler("wind",{name:"speed_range",auxiliary(e){const{speed:t}=this.elements;t.value=e},update:d}),a.addHandler("wind",{name:"gust",format:e=>e.replace(/[^0-9]/,"").slice(0,2),auxiliary(e){const{gust_range:t}=this.elements;t.value=n(e)?0:+e},update:d}),a.addHandler("wind",{name:"gust_range",auxiliary(e){const{gust:t}=this.elements;t.value=e},update:d}),a.addHandler("visibility",{format:e=>e.replace(/\D/g,"").slice(0,4),auxiliary(e){const{visibility_range:a}=this.elements,n=+e,s=n<800?50:n<5e3?100:n<9999?1e3:0;let r=t.at(-1);if(s>0){const e=Math.floor(n/s)*s;r=t.indexOf(e)}a.value=r.toString()},update:o}),a.addHandler("visibility",{name:"visibility_range",init(e){const{visibility_range:a}=this.elements;a.setAttribute("max",t.length-1)},auxiliary(e){const{visibility:a}=this.elements;a.value=t.at(+e)},update:o});const c=r(a.elements.precipitation,["DZ","RA","SN","SG","PL","GS","GR","DZ","RA","SN","SG","PL","GS","GR","RASN","SNRA","SHSN","SHRA","SHGR","FZRA","FZDZ","TSRA","TSGR","TSGS","TSSN","DS","SS"]),U=r(a.elements.phenomena,["FG","FZFG","VCFG","MIFG","PRFG","BCFG","BR","HZ","FU","DRSN","DRSA","DRDU","DU","BLSN","BLDU","SQ","IC","TS","VCTS","VA"]);function p(){const{value:e}=this.elements.weather;return e.length>1?e:""}function m(e,t){const{weather:a,intensity:n}=this.elements;for(const s of n)s===t.target?a.value=(t.target.checked?s.value:"")+a.value.replace(/[^A-Z ]/,""):s.checked=!1}function h(e,t){const{weather:a}=this.elements;(a.value.length>2||2===a.value.length&&"!"!==a.value.at(0))&&(a.value+=" "),a.value+=e.toUpperCase()}a.addHandler("weather",{format:function(e){const{intensity:t}=this.elements,a=e.toUpperCase().replace(new RegExp("(?<=^)[^-+A-Z]|(?<!^)[^A-Z ]"),"").replace(/^-\s/,"-").replace(/\s{2,}/g," "),n=a.at(0);for(const s of t)s.checked=s.value===n;return a},update:p}),a.addHandler("weather",{name:"weather_minus",event:"click",auxiliary:m,update:p}),a.addHandler("weather",{name:"weather_plus",event:"click",auxiliary:m,update:p}),a.addHandler("weather",{name:"precipitation",init:c,event:"change",auxiliary:h,update:p}),a.addHandler("weather",{name:"phenomena",init:U,event:"change",auxiliary:h,update:p});const v=r(a.elements.clouds_variants,["SKC","NSC","FEW","SCT","BKN","OVC"]);function S(){const{value:e}=this.elements.clouds;if(e.length>5)return e}function f(){const{elements:e}=a,{clouds:t,height:n}=e,s=e.clouds_variants,r=e.clouds_type;let i="";for(const a of s.options)if(a.selected){i=a.value.toUpperCase();break}const l=n.value.padStart(3,"0");let u="";for(const a of r)if(a.checked){u=a.value.toUpperCase();break}t.value=i+l+u}function g(e,t){const a=this.elements.clouds_type;for(const n of a)n===t.target||(n.checked=!1);f()}function H(e){return(e=+e.match(/-?\d?\d?/))<-80?-80:e>60?60:e}function R(e,t){const{temperature:a,temperature_range:n}=this.elements,{dew_point:s,dew_point_range:r}=this.elements;let i=null;switch(t.target){case a:i=n;break;case s:i=r;break;default:return}i.value=e}function y(e,t){const{temperature:a,temperature_range:n}=this.elements,{dew_point:s,dew_point_range:r}=this.elements;let i=null;switch(t.target){case n:i=a;break;case r:i=s;break;default:return}i.value=e}function _(e,t){const{temperature:a,dew_point:n}=this.elements,s=+a.value<0,r=+n.value<0,i=(s?"M":"")+Math.abs(+a.value).toString().padStart(2,"0"),l=(r?"M":"")+Math.abs(+n.value).toString().padStart(2,"0");return i.length||l.length?`${i}/${l}`:""}function W(e,t){return"Q"+e.padStart(4,"0")}a.addHandler("clouds",{name:"clouds",format:function(e){return e.toUpperCase().replace(/[^A-Z\d]/,"")},auxiliary(e){let t="";const{height:a}=this.elements;t=e.replace(/\D/g,"").slice(0,3);const s=n(t)?0:+t;a.value=s>100?100:s;const r=this.elements.clouds_variants;t=e.slice(0,3);for(const n of r.options)if(n.value===t){r.value=n.value;break}const i=this.elements.clouds_type;t=e.replace(/\s/g,"").slice(6);for(const n of i)n.checked=n.value===t},update:S}),a.addHandler("clouds",{name:"height",auxiliary:f,update:S}),a.addHandler("clouds",{name:"clouds_variants",init:v,event:"change",auxiliary:f,update:S}),a.addHandler("clouds",{name:"cb",event:"click",auxiliary:g,update:S}),a.addHandler("clouds",{name:"tcu",event:"click",auxiliary:g,update:S}),a.addHandler("temperature",{format:H,auxiliary:R,update:_}),a.addHandler("temperature",{name:"temperature_range",auxiliary:y,update:_}),a.addHandler("temperature",{name:"dew_point",format:H,auxiliary:R,update:_}),a.addHandler("temperature",{name:"dew_point_range",auxiliary:y,update:_}),a.addHandler("pressure",{format:e=>e.replace(/\D/g,"").slice(0,4),auxiliary(e){e=+e,this.elements.pressure_range.value=e<500?500:e>1100?1100:e},update:W}),a.addHandler("pressure",{name:"pressure_range",auxiliary(e){const{pressure:t}=this.elements;t.value=e},update:W});
